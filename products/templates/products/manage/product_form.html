{% extends "products/manage/base_manage.html" %}

{% block title %}{{ title }} - Parfumerie Anas{% endblock %}

{% block content %}
    <div class="page-header">
        <h1 class="page-title">{{ title }}</h1>
        <a href="{% url 'products:product_manage_list' %}" class="btn btn-secondary">Retour à la liste</a>
    </div>

    <div class="card">
        <div class="card-body">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {{ form.non_field_errors }}
                    </div>
                {% endif %}

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <div class="form-group">
                            <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }} *</label>
                            {{ form.name }}
                            {% if form.name.errors %}
                                <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                    {{ form.name.errors }}
                                </div>
                            {% endif %}
                            {% if form.name.help_text %}
                                <small style="color: #6c757d;">{{ form.name.help_text }}</small>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.slug.id_for_label }}" class="form-label">{{ form.slug.label }}</label>
                            {{ form.slug }}
                            {% if form.slug.errors %}
                                <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                    {{ form.slug.errors }}
                                </div>
                            {% endif %}
                            {% if form.slug.help_text %}
                                <small style="color: #6c757d;">{{ form.slug.help_text }}</small>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.category.id_for_label }}" class="form-label">{{ form.category.label }} *</label>
                            {{ form.category }}
                            {% if form.category.errors %}
                                <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                    {{ form.category.errors }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.price.id_for_label }}" class="form-label">{{ form.price.label }} *</label>
                            {{ form.price }}
                            {% if form.price.errors %}
                                <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                    {{ form.price.errors }}
                                </div>
                            {% endif %}
                            {% if form.price.help_text %}
                                <small style="color: #6c757d;">{{ form.price.help_text }}</small>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <div class="form-check">
                                {{ form.available }}
                                <label for="{{ form.available.id_for_label }}" class="form-label">{{ form.available.label }}</label>
                            </div>
                            {% if form.available.errors %}
                                <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                    {{ form.available.errors }}
                                </div>
                            {% endif %}
                            {% if form.available.help_text %}
                                <small style="color: #6c757d;">{{ form.available.help_text }}</small>
                            {% endif %}
                        </div>
                    </div>

                    <div>
                        <div class="form-group">
                            <label for="{{ form.image.id_for_label }}" class="form-label">{{ form.image.label }}</label>
                            {{ form.image }}
                            {% if form.image.errors %}
                                <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                    {{ form.image.errors }}
                                </div>
                            {% endif %}
                            {% if product.image %}
                                <div style="margin-top: 1rem;">
                                    <p><strong>Image actuelle :</strong></p>
                                    <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                                         style="max-width: 200px; max-height: 200px; object-fit: cover; border-radius: 8px;">
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
                            {{ form.description }}
                            {% if form.description.errors %}
                                <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                    {{ form.description.errors }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e9ecef;">
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <a href="{% url 'products:product_manage_list' %}" class="btn btn-secondary">Annuler</a>
                        <button type="submit" class="btn btn-success">
                            {% if action == 'create' %}Créer le produit{% else %}Sauvegarder les modifications{% endif %}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Auto-génération du slug à partir du nom
        document.addEventListener('DOMContentLoaded', function() {
            const nameField = document.getElementById('{{ form.name.id_for_label }}');
            const slugField = document.getElementById('{{ form.slug.id_for_label }}');
            
            if (nameField && slugField) {
                nameField.addEventListener('input', function() {
                    if (!slugField.value || slugField.dataset.autoGenerated !== 'false') {
                        const slug = this.value
                            .toLowerCase()
                            .replace(/[^a-z0-9\s-]/g, '')
                            .replace(/\s+/g, '-')
                            .replace(/-+/g, '-')
                            .trim('-');
                        slugField.value = slug;
                        slugField.dataset.autoGenerated = 'true';
                    }
                });
                
                slugField.addEventListener('input', function() {
                    this.dataset.autoGenerated = 'false';
                });
            }
        });
    </script>
{% endblock %}


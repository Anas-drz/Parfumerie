{% extends "products/manage/base_manage.html" %}

{% block title %}{{ title }} - Parfumerie Anas{% endblock %}

{% block content %}
    <div class="page-header">
        <h1 class="page-title">{{ title }}</h1>
        <a href="{% url 'products:category_list' %}" class="btn btn-secondary">Retour à la liste</a>
    </div>

    <div class="card">
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {{ form.non_field_errors }}
                    </div>
                {% endif %}

                <div style="max-width: 600px;">
                    <div class="form-group">
                        <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }} *</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                {{ form.name.errors }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.slug.id_for_label }}" class="form-label">{{ form.slug.label }}</label>
                        {{ form.slug }}
                        {% if form.slug.errors %}
                            <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                {{ form.slug.errors }}
                            </div>
                        {% endif %}
                        {% if form.slug.help_text %}
                            <small style="color: #6c757d;">{{ form.slug.help_text }}</small>
                        {% endif %}
                    </div>
                </div>

                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e9ecef;">
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <a href="{% url 'products:category_list' %}" class="btn btn-secondary">Annuler</a>
                        <button type="submit" class="btn btn-success">
                            {% if action == 'create' %}Créer la catégorie{% else %}Sauvegarder les modifications{% endif %}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Auto-génération du slug à partir du nom
        document.addEventListener('DOMContentLoaded', function() {
            const nameField = document.getElementById('{{ form.name.id_for_label }}');
            const slugField = document.getElementById('{{ form.slug.id_for_label }}');
            
            if (nameField && slugField) {
                nameField.addEventListener('input', function() {
                    if (!slugField.value || slugField.dataset.autoGenerated !== 'false') {
                        const slug = this.value
                            .toLowerCase()
                            .replace(/[^a-z0-9\s-]/g, '')
                            .replace(/\s+/g, '-')
                            .replace(/-+/g, '-')
                            .trim('-');
                        slugField.value = slug;
                        slugField.dataset.autoGenerated = 'true';
                    }
                });
                
                slugField.addEventListener('input', function() {
                    this.dataset.autoGenerated = 'false';
                });
            }
        });
    </script>
{% endblock %}

